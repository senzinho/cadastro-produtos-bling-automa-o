<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro em Massa - Bling</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0f1419;
            color: #20B2AA;
            min-height: 100vh;
            padding: 40px 20px;
        }

        #app {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 0 0 40px 0;
            margin-bottom: 40px;
            border-bottom: 1px solid #1a2930;
        }

        .header h1 {
            font-size: 2em;
            color: #20B2AA;
            font-weight: 400;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .header p {
            color: #5F9EA0;
            font-size: 0.95em;
            font-weight: 300;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: #161f27;
            border: 1px solid #1a2930;
            border-radius: 8px;
            padding: 30px;
        }

        .card h2 {
            color: #20B2AA;
            margin-bottom: 24px;
            font-size: 1.1em;
            font-weight: 500;
            letter-spacing: -0.3px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #5F9EA0;
            font-size: 0.9em;
            font-weight: 400;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 14px;
            background: #0f1419;
            border: 1px solid #1a2930;
            border-radius: 6px;
            color: #20B2AA;
            font-size: 0.95em;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #20B2AA;
            background: #161f27;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .btn {
            padding: 12px 24px;
            background: #20B2AA;
            color: #0f1419;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #48D1CC;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            color: #20B2AA;
            border: 1px solid #1a2930;
        }

        .btn-secondary:hover {
            background: #161f27;
            border-color: #20B2AA;
        }

        .btn-danger {
            background: transparent;
            color: #e85d75;
            border: 1px solid #1a2930;
        }

        .btn-danger:hover {
            background: rgba(232, 93, 117, 0.1);
            border-color: #e85d75;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: transparent;
            color: #20B2AA;
            border: 1px solid #1a2930;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            font-weight: 500;
        }

        .file-label:hover {
            background: #161f27;
            border-color: #20B2AA;
        }

        .divider {
            border: none;
            border-top: 1px solid #1a2930;
            margin: 30px 0;
        }

        .tabela-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid #1a2930;
        }

        th {
            background: transparent;
            color: #5F9EA0;
            font-weight: 500;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: #20B2AA;
            font-size: 0.9em;
        }

        tr:hover {
            background: rgba(32, 178, 170, 0.03);
        }

        .status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-pendente {
            background: rgba(255, 193, 7, 0.15);
            color: #FFC107;
        }

        .status-sucesso {
            background: rgba(32, 178, 170, 0.15);
            color: #20B2AA;
        }

        .status-erro {
            background: rgba(232, 93, 117, 0.15);
            color: #e85d75;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #161f27;
            border: 1px solid #1a2930;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
        }

        .stat-card h3 {
            color: #5F9EA0;
            font-size: 0.85em;
            margin-bottom: 12px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .numero {
            font-size: 2.2em;
            color: #20B2AA;
            font-weight: 300;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid;
            font-size: 0.9em;
        }

        .alert-success {
            background: rgba(32, 178, 170, 0.1);
            border-color: #20B2AA;
            color: #20B2AA;
        }

        .alert-error {
            background: rgba(232, 93, 117, 0.1);
            border-color: #e85d75;
            color: #e85d75;
        }

        .alert-info {
            background: rgba(95, 158, 160, 0.1);
            border-color: #5F9EA0;
            color: #5F9EA0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #5F9EA0;
            font-size: 1em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #5F9EA0;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .info-text {
            color: #5F9EA0;
            margin-top: 12px;
            font-size: 0.85em;
            line-height: 1.5;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            body {
                padding: 20px 15px;
            }

            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1>Cadastro em Massa - Bling</h1>
            <p>Sistema de importação de produtos via API</p>
        </div>

        <!-- Estatísticas -->
        <div class="stats">
            <div class="stat-card">
                <h3>Total</h3>
                <div class="numero">{{ produtos.length }}</div>
            </div>
            <div class="stat-card">
                <h3>Cadastrados</h3>
                <div class="numero">{{ produtosCadastrados }}</div>
            </div>
            <div class="stat-card">
                <h3>Pendentes</h3>
                <div class="numero">{{ produtosPendentes }}</div>
            </div>
            <div class="stat-card">
                <h3>Erros</h3>
                <div class="numero">{{ produtosErro }}</div>
            </div>
        </div>

        <!-- Alertas -->
        <div v-if="alerta.mostrar" :class="'alert alert-' + alerta.tipo">
            {{ alerta.mensagem }}
        </div>

        <div class="container">
            <!-- Formulário -->
            <div class="card">
                <h2>Adicionar Produto</h2>
                
                <div class="form-group">
                    <label>Nome do Produto *</label>
                    <input v-model="novoProduto.nome" type="text" placeholder="Ex: Camiseta Básica">
                </div>

                <div class="form-group">
                    <label>Código *</label>
                    <input v-model="novoProduto.codigo" type="text" placeholder="Ex: PROD001">
                </div>

                <div class="grid-2">
                    <div class="form-group">
                        <label>Preço (R$) *</label>
                        <input v-model="novoProduto.preco" type="number" step="0.01" placeholder="99.90">
                    </div>

                    <div class="form-group">
                        <label>Unidade *</label>
                        <select v-model="novoProduto.unidade">
                            <option value="UN">Unidade</option>
                            <option value="PC">Peça</option>
                            <option value="KG">Quilograma</option>
                            <option value="MT">Metro</option>
                            <option value="CX">Caixa</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Descrição Curta</label>
                    <textarea v-model="novoProduto.descricaoCurta" placeholder="Descrição breve do produto"></textarea>
                </div>

                <div class="btn-group">
                    <button class="btn" @click="adicionarProduto">Adicionar</button>
                    <button class="btn btn-secondary" @click="limparFormulario">Limpar</button>
                </div>

                <hr class="divider">

                <h2>Importar CSV</h2>
                <input type="file" id="fileInput" class="file-input" accept=".csv" @change="importarCSV">
                <label for="fileInput" class="file-label">Selecionar Arquivo</label>
                
                <p class="info-text">
                    Formato: nome, codigo, preco, unidade, descricaoCurta
                </p>
            </div>

            <!-- Lista de Produtos -->
            <div class="card">
                <h2>Produtos na Fila</h2>
                
                <div v-if="produtos.length === 0" class="empty-state">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                    </svg>
                    <div>Nenhum produto adicionado</div>
                </div>

                <div v-else>
                    <div class="tabela-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Código</th>
                                    <th>Preço</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(produto, index) in produtos" :key="index">
                                    <td>{{ produto.nome }}</td>
                                    <td>{{ produto.codigo }}</td>
                                    <td>R$ {{ parseFloat(produto.preco).toFixed(2) }}</td>
                                    <td>
                                        <span :class="'status status-' + produto.status">
                                            {{ produto.statusTexto }}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.85em;" @click="removerProduto(index)">
                                            Remover
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="btn-group" style="margin-top: 24px;">
                        <button class="btn" @click="enviarProdutos" :disabled="carregando">
                            {{ carregando ? 'Enviando...' : 'Enviar para Bling' }}
                        </button>
                        <button class="btn btn-danger" @click="limparTodos">
                            Limpar Todos
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="carregando" class="loading">
            Enviando produtos para o Bling
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    novoProduto: {
                        nome: '',
                        codigo: '',
                        preco: '',
                        tipo: 'P',
                        situacao: 'A',
                        formato: 'S',
                        unidade: 'UN',
                        descricaoCurta: ''
                    },
                    produtos: [],
                    carregando: false,
                    alerta: {
                        mostrar: false,
                        tipo: 'success',
                        mensagem: ''
                    },
                    apiUrl: 'http://localhost:5000'
                }
            },
            computed: {
                produtosCadastrados() {
                    return this.produtos.filter(p => p.status === 'sucesso').length;
                },
                produtosPendentes() {
                    return this.produtos.filter(p => p.status === 'pendente').length;
                },
                produtosErro() {
                    return this.produtos.filter(p => p.status === 'erro').length;
                }
            },
            methods: {
                adicionarProduto() {
                    if (!this.novoProduto.nome || !this.novoProduto.codigo || !this.novoProduto.preco) {
                        this.mostrarAlerta('Por favor, preencha todos os campos obrigatórios!', 'error');
                        return;
                    }

                    const produto = {
                        ...this.novoProduto,
                        status: 'pendente',
                        statusTexto: 'Pendente'
                    };

                    this.produtos.push(produto);
                    this.mostrarAlerta('Produto adicionado com sucesso!', 'success');
                    this.limparFormulario();
                },

                limparFormulario() {
                    this.novoProduto = {
                        nome: '',
                        codigo: '',
                        preco: '',
                        tipo: 'P',
                        situacao: 'A',
                        formato: 'S',
                        unidade: 'UN',
                        descricaoCurta: ''
                    };
                },

                removerProduto(index) {
                    this.produtos.splice(index, 1);
                    this.mostrarAlerta('Produto removido!', 'info');
                },

                limparTodos() {
                    if (confirm('Deseja realmente limpar todos os produtos?')) {
                        this.produtos = [];
                        this.mostrarAlerta('Todos os produtos foram removidos!', 'info');
                    }
                },

                importarCSV(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    Papa.parse(file, {
                        header: true,
                        complete: (results) => {
                            let importados = 0;
                            results.data.forEach(row => {
                                if (row.nome && row.codigo && row.preco) {
                                    this.produtos.push({
                                        nome: row.nome,
                                        codigo: row.codigo,
                                        preco: parseFloat(row.preco),
                                        tipo: 'P',
                                        situacao: 'A',
                                        formato: 'S',
                                        unidade: row.unidade || 'UN',
                                        descricaoCurta: row.descricaoCurta || '',
                                        status: 'pendente',
                                        statusTexto: 'Pendente'
                                    });
                                    importados++;
                                }
                            });
                            this.mostrarAlerta(`${importados} produtos importados do CSV!`, 'success');
                            event.target.value = '';
                        },
                        error: (error) => {
                            this.mostrarAlerta('Erro ao importar CSV: ' + error.message, 'error');
                        }
                    });
                },

                async enviarProdutos() {
                    if (this.produtos.length === 0) {
                        this.mostrarAlerta('Nenhum produto para enviar!', 'error');
                        return;
                    }

                    this.carregando = true;

                    const produtosParaEnviar = this.produtos
                        .filter(p => p.status === 'pendente')
                        .map(({ status, statusTexto, ...produto }) => produto);

                    try {
                        const response = await fetch(`${this.apiUrl}/cadastrar-produtos-massa`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ produtos: produtosParaEnviar })
                        });

                        const resultado = await response.json();

                        resultado.detalhes.forEach(detalhe => {
                            const produto = this.produtos[detalhe.index];
                            if (produto) {
                                produto.status = detalhe.success ? 'sucesso' : 'erro';
                                produto.statusTexto = detalhe.success ? 'Cadastrado' : 'Erro';
                            }
                        });

                        this.mostrarAlerta(
                            `Processo finalizado! ${resultado.sucessos} sucesso(s), ${resultado.falhas} erro(s)`,
                            resultado.falhas === 0 ? 'success' : 'error'
                        );

                    } catch (error) {
                        this.mostrarAlerta('Erro ao conectar com a API: ' + error.message, 'error');
                    } finally {
                        this.carregando = false;
                    }
                },

                mostrarAlerta(mensagem, tipo) {
                    this.alerta.mensagem = mensagem;
                    this.alerta.tipo = tipo;
                    this.alerta.mostrar = true;

                    setTimeout(() => {
                        this.alerta.mostrar = false;
                    }, 5000);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>